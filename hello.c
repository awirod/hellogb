#include <gb/gb.h>
#include <gb/drawing.h>
#include "hello.h"

#define MAP_WIDTH 20
#define MAP_HEIGHT 18

struct point {
  UINT8 x;
  UINT8 y;
};


// key status
static UINT8 keys;


static UINT8 map[] = {
  0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x11,
  0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x01, 0x11, 0x10, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x11, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
  0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
  0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
  0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11
};

struct point myposition;
UINT8 fall_speed = 0;



void draw_map() {
  UINT8 *map_ptr = map;
  UINT8 x, y;
  UINT8 tmp_x, tmp_y;

  for(y = 0; y < MAP_HEIGHT; y++) {
    for(x = 0; x < MAP_WIDTH >> 1; x++) {

      tmp_x = x << 4;
      tmp_y = y << 3;
      if ((*map_ptr >> 4) & 0x0f) {
        box(tmp_x, tmp_y, tmp_x + 7, tmp_y + 7, M_NOFILL);
      }
      if (*map_ptr & 0x0f) {
        tmp_x += 8;
        box(tmp_x, tmp_y, tmp_x + 7, tmp_y + 7, M_NOFILL);
      }
      map_ptr++;
    }
  }
}

void main() {

  // Initialize
  myposition.x = 24;
  myposition.y =24;

  // Main Loop
  for(;;) {

    keys = joypad();
    if (keys & J_LEFT) {
      myposition.x--;
    }
    if (keys & J_RIGHT) {
      myposition.x++;
    }

    if (keys & J_UP) {
      myposition.y--;
    }

    if (keys & J_DOWN) {
      myposition.y++;
    }
    
    draw_map();
    circle(myposition.x, myposition.y, 4, M_NOFILL);
  }
}

